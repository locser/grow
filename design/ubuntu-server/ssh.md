ƒê·ªÉ k·∫øt n·ªëi **SSH t·ª´ m√°y Mac t·ªõi Ubuntu Server** trong c√πng m·ªôt m·∫°ng Wi-Fi, b·∫°n c·∫ßn l√†m theo c√°c b∆∞·ªõc sau:

---

## üõ† **1. Ki·ªÉm Tra ƒê·ªãa Ch·ªâ IP C·ªßa Ubuntu Server**

Tr√™n Ubuntu Server, ch·∫°y:

```bash
ip a
```

T√¨m d√≤ng c√≥ **"wlan0"** ho·∫∑c **"eth0"**, b·∫°n s·∫Ω th·∫•y ƒë·ªãa ch·ªâ IP nh∆∞ `192.168.x.x`.

üìå **V√≠ d·ª•**: N·∫øu IP c·ªßa Ubuntu Server l√† **192.168.1.100**, b·∫°n s·∫Ω d√πng ƒë·ªãa ch·ªâ n√†y ƒë·ªÉ SSH.

---

## üîë **2. C√†i ƒê·∫∑t & K√≠ch Ho·∫°t SSH Tr√™n Ubuntu Server**

N·∫øu Ubuntu ch∆∞a c√≥ SSH, c√†i ƒë·∫∑t n√≥ b·∫±ng:

```bash
sudo apt update
sudo apt install openssh-server -y
```

Sau ƒë√≥, kh·ªüi ƒë·ªông SSH:

```bash
sudo systemctl enable --now ssh
sudo systemctl status ssh
```

N·∫øu th·∫•y **active (running)** l√† SSH ƒëang ch·∫°y.

---

## üíª **3. K·∫øt N·ªëi SSH T·ª´ MacOS**

Tr√™n m√°y Mac, m·ªü Terminal v√† ch·∫°y:

```bash
ssh username@192.168.1.100
```

üìå **Thay `username` b·∫±ng user tr√™n Ubuntu Server**, v√≠ d·ª•:

```bash
ssh ubuntu@192.168.1.100
```

Nh·∫≠p m·∫≠t kh·∫©u khi ƒë∆∞·ª£c y√™u c·∫ßu.

---

## üîë **4. Thi·∫øt L·∫≠p SSH Kh√¥ng C·∫ßn M·∫≠t Kh·∫©u (SSH Key)**

N·∫øu b·∫°n mu·ªën **k·∫øt n·ªëi m√† kh√¥ng c·∫ßn nh·∫≠p m·∫≠t kh·∫©u**, th·ª±c hi·ªán nh∆∞ sau:

### üìå **4.1. T·∫°o SSH Key Tr√™n Mac**

Tr√™n m√°y Mac, ch·∫°y:

```bash
ssh-keygen -t rsa -b 4096
```

Nh·∫•n **Enter** nhi·ªÅu l·∫ßn ƒë·ªÉ d√πng c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh.

---

### üìå **4.2. Copy SSH Key Sang Ubuntu**

D√πng l·ªánh sau ƒë·ªÉ copy SSH key t·ª´ Mac sang Ubuntu:

```bash
ssh-copy-id ubuntu@192.168.1.100
```

(Nh·∫≠p m·∫≠t kh·∫©u l·∫ßn ƒë·∫ßu ƒë·ªÉ x√°c th·ª±c).

N·∫øu `ssh-copy-id` kh√¥ng ho·∫°t ƒë·ªông, c√≥ th·ªÉ copy th·ªß c√¥ng:

```bash
cat ~/.ssh/id_rsa.pub | ssh ubuntu@192.168.1.100 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

Sau ƒë√≥, th·ª≠ SSH l·∫°i:

```bash
ssh ubuntu@192.168.1.100
```

N·∫øu v√†o ƒë∆∞·ª£c m√† **kh√¥ng c·∫ßn m·∫≠t kh·∫©u**, b·∫°n ƒë√£ thi·∫øt l·∫≠p th√†nh c√¥ng!

---

## üîÑ **5. Ki·ªÉm Tra & Kh·∫Øc Ph·ª•c L·ªói N·∫øu Kh√¥ng K·∫øt N·ªëi ƒê∆∞·ª£c**

1Ô∏è‚É£ **Ki·ªÉm tra SSH c√≥ ch·∫°y kh√¥ng**

```bash
sudo systemctl status ssh
```

N·∫øu kh√¥ng ch·∫°y, kh·ªüi ƒë·ªông l·∫°i:

```bash
sudo systemctl restart ssh
```

2Ô∏è‚É£ **Ki·ªÉm tra firewall (n·∫øu c√≥)**
N·∫øu d√πng **UFW** (Uncomplicated Firewall), m·ªü c·ªïng SSH:

```bash
sudo ufw allow ssh
sudo ufw enable
```

Ki·ªÉm tra tr·∫°ng th√°i UFW:

```bash
sudo ufw status
```

3Ô∏è‚É£ **Ki·ªÉm tra k·∫øt n·ªëi m·∫°ng**
Tr√™n m√°y Mac, th·ª≠ ping Ubuntu Server:

```bash
ping 192.168.1.100
```

N·∫øu kh√¥ng c√≥ ph·∫£n h·ªìi, c√≥ th·ªÉ hai m√°y ch∆∞a c√πng m·∫°ng ho·∫∑c Ubuntu c√≥ l·ªói c·∫•u h√¨nh m·∫°ng.

---

## üöÄ **T√≥m L·∫°i**

‚úî **L·∫•y ƒë·ªãa ch·ªâ IP c·ªßa Ubuntu (`ip a`)**.
‚úî **C√†i SSH Server tr√™n Ubuntu (`sudo apt install openssh-server`)**.
‚úî **K·∫øt n·ªëi t·ª´ Mac b·∫±ng `ssh user@192.168.x.x`**.
‚úî **Thi·∫øt l·∫≠p SSH Key ƒë·ªÉ kh√¥ng c·∫ßn nh·∫≠p m·∫≠t kh·∫©u**.
‚úî **M·ªü c·ªïng SSH trong firewall n·∫øu c·∫ßn (`sudo ufw allow ssh`)**.

T·ªët! Gi·ªù b·∫°n c√≥ th·ªÉ ti·∫øp t·ª•c v·ªõi vi·ªác thi·∫øt l·∫≠p user v√† firewall.

### 1Ô∏è‚É£ **Thi·∫øt l·∫≠p User**

M·∫∑c ƒë·ªãnh, b·∫°n th∆∞·ªùng ƒëƒÉng nh·∫≠p v·ªõi user `root`, nh∆∞ng t·ªët h∆°n l√† t·∫°o m·ªôt user th∆∞·ªùng v√† c·∫•p quy·ªÅn sudo ƒë·ªÉ tƒÉng b·∫£o m·∫≠t.

#### **T·∫°o user m·ªõi**

Thay `youruser` b·∫±ng t√™n b·∫°n mu·ªën:

```bash
sudo adduser youruser
```

Nh·∫≠p m·∫≠t kh·∫©u v√† th√¥ng tin c·∫ßn thi·∫øt.

#### **C·∫•p quy·ªÅn sudo cho user**

```bash
sudo usermod -aG sudo youruser
```

Gi·ªù b·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p b·∫±ng:

```bash
su - youruser
```

#### **C·∫•u h√¨nh SSH ƒë·ªÉ ch·ªâ cho ph√©p user m·ªõi** _(T√πy ch·ªçn, n·∫øu mu·ªën b·∫£o m·∫≠t h∆°n)_

M·ªü file c·∫•u h√¨nh SSH:

```bash
sudo nano /etc/ssh/sshd_config
```

- T√¨m d√≤ng `PermitRootLogin` v√† ƒë·ªïi th√†nh `no`.
- Th√™m d√≤ng:
  ```bash
  AllowUsers youruser
  ```
- L∆∞u l·∫°i (`Ctrl + X`, `Y`, `Enter`).

Kh·ªüi ƒë·ªông l·∫°i SSH:

```bash
sudo systemctl restart ssh
```

---

### 2Ô∏è‚É£ **Thi·∫øt l·∫≠p Firewall (UFW - Uncomplicated Firewall)**

Ubuntu d√πng `ufw` ƒë·ªÉ qu·∫£n l√Ω firewall.

#### **C√†i ƒë·∫∑t UFW (n·∫øu ch∆∞a c√≥)**

```bash
sudo apt update && sudo apt install ufw -y
```

#### **C·∫•u h√¨nh c∆° b·∫£n**

- **M·ªü SSH** _(n·∫øu kh√¥ng, b·∫°n s·∫Ω b·ªã kh√≥a ngo√†i!)_

  ```bash
  sudo ufw allow OpenSSHx   # M·∫∑c ƒë·ªãnh c·ªïng SSH l√† 22
  ```

  Ho·∫∑c n·∫øu d√πng c·ªïng SSH t√πy ch·ªânh:

  ```bash
  sudo ufw allow 2222/tcp  # Thay 2222 b·∫±ng c·ªïng SSH b·∫°n ƒë√£ ƒë·∫∑t
  ```

- **M·ªü HTTP/HTTPS (n·∫øu b·∫°n ch·∫°y web server)**

  ```bash
  sudo ufw allow http
  sudo ufw allow https
  ```

- **Ch·∫∑n t·∫•t c·∫£ c√°c k·∫øt n·ªëi kh√¥ng mong mu·ªën**

  ```bash
  sudo ufw default deny incoming
  sudo ufw default allow outgoing
  ```

- **B·∫≠t UFW**

  ```bash
  sudo ufw enable
  ```

- **Ki·ªÉm tra tr·∫°ng th√°i**
  ```bash
  sudo ufw status verbose
  ```

---

### üéØ **Ti·∫øp theo l√†m g√¨?**

- N·∫øu b·∫°n ƒë√£ xong user v√† firewall, c√≥ th·ªÉ ti·∫øp t·ª•c v·ªõi Docker & Kubernetes (B∆∞·ªõc 3).
- N·∫øu mu·ªën b·∫£o m·∫≠t h∆°n, c√≥ th·ªÉ b·∫≠t `fail2ban` ƒë·ªÉ ch·ªëng brute-force SSH.

üî• **Firewall n√¢ng cao trong Linux (UFW, iptables, nftables)**

B·∫°n ƒë√£ bi·∫øt c√°ch d√πng **UFW** (Uncomplicated Firewall), nh∆∞ng n·∫øu mu·ªën ki·ªÉm so√°t m·∫°nh h∆°n, b·∫°n c√≥ th·ªÉ t√¨m hi·ªÉu v·ªÅ **iptables** v√† **nftables**.

---

## üõ° **1. UFW n√¢ng cao**

M·∫∑c d√π UFW l√† giao di·ªán ƒë∆°n gi·∫£n c·ªßa `iptables`, nh∆∞ng n√≥ v·∫´n c√≥ nhi·ªÅu t√≠nh nƒÉng n√¢ng cao.

### 1Ô∏è‚É£ **Ch·∫∑n m·ªôt ƒë·ªãa ch·ªâ IP c·ª• th·ªÉ**

N·∫øu b·∫°n ph√°t hi·ªán m·ªôt IP ƒë√°ng ng·ªù, c√≥ th·ªÉ ch·∫∑n nh∆∞ sau:

```bash
sudo ufw deny from 192.168.1.100
```

### 2Ô∏è‚É£ **Ch·∫∑n theo ph·∫°m vi IP (CIDR)**

V√≠ d·ª•, ch·∫∑n to√†n b·ªô d·∫£i IP **192.168.1.0 - 192.168.1.255**

```bash
sudo ufw deny from 192.168.1.0/24
```

### 3Ô∏è‚É£ **Ch·∫∑n theo qu·ªëc gia**

D√πng `xtables-addons` ƒë·ªÉ ch·∫∑n t·∫•t c·∫£ IP t·ª´ m·ªôt qu·ªëc gia (v√≠ d·ª•: Trung Qu·ªëc):

```bash
sudo apt install xtables-addons-common
sudo ipset create china hash:net
sudo iptables -A INPUT -m set --match-set china src -j DROP
```

(L·∫•y danh s√°ch IP t·ª´ c√°c ngu·ªìn nh∆∞ [IPdeny](http://www.ipdeny.com/)).

### 4Ô∏è‚É£ **Gi·ªõi h·∫°n s·ªë l·∫ßn k·∫øt n·ªëi SSH ƒë·ªÉ ch·ªëng brute-force**

```bash
sudo ufw limit OpenSSH
```

ƒêi·ªÅu n√†y s·∫Ω gi·ªõi h·∫°n s·ªë l·∫ßn k·∫øt n·ªëi SSH trong m·ªôt kho·∫£ng th·ªùi gian ng·∫Øn, gi√∫p b·∫£o v·ªá kh·ªèi c√°c cu·ªôc t·∫•n c√¥ng th·ª≠ m·∫≠t kh·∫©u.

---

## üî• **2. iptables ‚Äì Firewall m·∫°nh m·∫Ω h∆°n**

**iptables** l√† c√¥ng c·ª• m·∫°nh h∆°n UFW, cho ph√©p ki·ªÉm so√°t chi ti·∫øt h∆°n l∆∞u l∆∞·ª£ng m·∫°ng.

### 1Ô∏è‚É£ **Ki·ªÉm tra danh s√°ch lu·∫≠t hi·ªán t·∫°i**

```bash
sudo iptables -L -v -n
```

### 2Ô∏è‚É£ **Ch·∫∑n m·ªôt ƒë·ªãa ch·ªâ IP c·ª• th·ªÉ**

```bash
sudo iptables -A INPUT -s 192.168.1.100 -j DROP
```

### 3Ô∏è‚É£ **Ch·∫∑n t·∫•t c·∫£ l∆∞u l∆∞·ª£ng ngo·∫°i tr·ª´ c√°c c·ªïng c·ª• th·ªÉ**

```bash
sudo iptables -P INPUT DROP
sudo iptables -P FORWARD DROP
sudo iptables -P OUTPUT ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT
```

ƒêi·ªÅu n√†y ch·∫∑n t·∫•t c·∫£ k·∫øt n·ªëi tr·ª´ SSH, HTTP v√† HTTPS.

### 4Ô∏è‚É£ **Ch·∫∑n Ping (ICMP)** ƒë·ªÉ tr√°nh b·ªã qu√©t m·∫°ng

```bash
sudo iptables -A INPUT -p icmp --icmp-type echo-request -j DROP
```

### 5Ô∏è‚É£ **L∆∞u l·∫°i lu·∫≠t iptables** (v√¨ khi reboot, c√°c lu·∫≠t s·∫Ω b·ªã m·∫•t)

```bash
sudo iptables-save | sudo tee /etc/iptables/rules.v4
```

---

## ‚ö° **3. nftables ‚Äì C√¥ng c·ª• firewall hi·ªán ƒë·∫°i h∆°n iptables**

_nftables_ l√† h·ªá th·ªëng firewall m·ªõi thay th·∫ø iptables tr√™n c√°c b·∫£n Linux m·ªõi.

### 1Ô∏è‚É£ **C√†i ƒë·∫∑t nftables**

```bash
sudo apt install nftables
```

### 2Ô∏è‚É£ **Ki·ªÉm tra b·∫£ng nftables**

```bash
sudo nft list ruleset
```

### 3Ô∏è‚É£ **T·∫°o lu·∫≠t m·ªõi ch·∫∑n m·ªôt IP**

```bash
sudo nft add table inet my_firewall
sudo nft add chain inet my_firewall input { type filter hook input priority 0 \; }
sudo nft add rule inet my_firewall input ip saddr 192.168.1.100 drop
```

---

## üèÜ **Khi n√†o n√™n d√πng UFW, iptables hay nftables?**

| C√¥ng c·ª•      | ƒê·ªô d·ªÖ d√πng | Hi·ªáu su·∫•t        | Ch·ª©c nƒÉng n√¢ng cao |
| ------------ | ---------- | ---------------- | ------------------ |
| **UFW**      | D·ªÖ nh·∫•t    | T·ªët              | H·∫°n ch·∫ø            |
| **iptables** | Trung b√¨nh | T·ªët              | R·∫•t m·∫°nh           |
| **nftables** | Kh√≥ h∆°n    | T·ªët h∆°n iptables | M·∫°nh nh·∫•t          |

- **D√πng UFW** n·∫øu b·∫°n ch·ªâ c·∫ßn b·∫£o m·∫≠t c∆° b·∫£n m√† kh√¥ng c·∫ßn t√πy ch·ªânh nhi·ªÅu.
- **D√πng iptables** n·∫øu b·∫°n c·∫ßn b·∫£o m·∫≠t chi ti·∫øt v√† linh ho·∫°t h∆°n.
- **D√πng nftables** n·∫øu b·∫°n l√†m h·ªá th·ªëng l·ªõn ho·∫∑c mu·ªën hi·ªáu su·∫•t cao h∆°n.

B·∫°n mu·ªën th·ª≠ nghi·ªám ph·∫ßn n√†o ti·∫øp theo? üöÄ

üî• **Ch·ªâ cho ph√©p m·ªôt s·ªë IP truy c·∫≠p v√†o server (Ch·∫∑n t·∫•t c·∫£ IP kh√°c)**

B·∫°n c√≥ th·ªÉ d√πng **UFW** ho·∫∑c **iptables** ƒë·ªÉ thi·∫øt l·∫≠p danh s√°ch **whitelist IP**.

---

## ‚úÖ **C√°ch 1: D√πng UFW (D·ªÖ nh·∫•t)**

Gi·∫£ s·ª≠ b·∫°n mu·ªën **ch·ªâ cho ph√©p** 2 ƒë·ªãa ch·ªâ IP sau truy c·∫≠p v√†o server:

- **192.168.1.10**
- **203.0.113.50**

### üìå **C√°c b∆∞·ªõc th·ª±c hi·ªán**

1Ô∏è‚É£ **Ch·∫∑n t·∫•t c·∫£ c√°c k·∫øt n·ªëi ƒë·∫øn**

```bash
sudo ufw default deny incoming
```

2Ô∏è‚É£ **Cho ph√©p IP c·ª• th·ªÉ truy c·∫≠p**

```bash
sudo ufw allow from 192.168.1.10
sudo ufw allow from 203.0.113.50
```

3Ô∏è‚É£ **N·∫øu ch·ªâ mu·ªën cho ph√©p IP truy c·∫≠p v√†o SSH (c·ªïng 22)**

```bash
sudo ufw allow from 192.168.1.10 to any port 22
sudo ufw allow from 203.0.113.50 to any port 22
```

4Ô∏è‚É£ **B·∫≠t l·∫°i UFW ƒë·ªÉ √°p d·ª•ng thay ƒë·ªïi**

```bash
sudo ufw enable
sudo ufw reload
```

5Ô∏è‚É£ **Ki·ªÉm tra l·∫°i firewall**

```bash
sudo ufw status
```

N·∫øu ƒë√∫ng, b·∫°n s·∫Ω th·∫•y danh s√°ch IP ƒë∆∞·ª£c ph√©p truy c·∫≠p.

---

## ‚úÖ **C√°ch 2: D√πng iptables (M·∫°nh h∆°n, chi ti·∫øt h∆°n)**

N·∫øu b·∫°n mu·ªën ki·ªÉm so√°t nhi·ªÅu h∆°n, d√πng `iptables` l√† m·ªôt l·ª±a ch·ªçn t·ªët.

1Ô∏è‚É£ **Ch·∫∑n t·∫•t c·∫£ k·∫øt n·ªëi ƒë·∫øn**

```bash
sudo iptables -P INPUT DROP
```

2Ô∏è‚É£ **Cho ph√©p IP c·ª• th·ªÉ truy c·∫≠p v√†o t·∫•t c·∫£ d·ªãch v·ª•**

```bash
sudo iptables -A INPUT -s 192.168.1.10 -j ACCEPT
sudo iptables -A INPUT -s 203.0.113.50 -j ACCEPT
```

3Ô∏è‚É£ **N·∫øu ch·ªâ mu·ªën cho ph√©p IP truy c·∫≠p SSH (c·ªïng 22)**

```bash
sudo iptables -A INPUT -p tcp --dport 22 -s 192.168.1.10 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -s 203.0.113.50 -j ACCEPT
```

4Ô∏è‚É£ **L∆∞u l·∫°i lu·∫≠t ƒë·ªÉ kh√¥ng b·ªã m·∫•t sau khi reboot**

```bash
sudo iptables-save | sudo tee /etc/iptables/rules.v4
```

5Ô∏è‚É£ **Ki·ªÉm tra l·∫°i firewall**

```bash
sudo iptables -L -v -n
```

---

## üöÄ **L·ª±a ch·ªçn n√†o ph√π h·ª£p?**

| **T√¨nh hu·ªëng**                              | **D√πng UFW** | **D√πng iptables** |
| ------------------------------------------- | ------------ | ----------------- |
| D·ªÖ thi·∫øt l·∫≠p, kh√¥ng c·∫ßn t√πy ch·ªânh nhi·ªÅu     | ‚úÖ           | ‚ùå                |
| Ki·ªÉm so√°t s√¢u h∆°n, ch·∫∑n theo nhi·ªÅu ti√™u ch√≠ | ‚ùå           | ‚úÖ                |
| C·∫ßn b·∫£o m·∫≠t nhanh, hi·ªáu qu·∫£                 | ‚úÖ           | ‚úÖ                |

üëâ N·∫øu b·∫°n ch·ªâ c·∫ßn ch·∫∑n ƒë∆°n gi·∫£n **=> d√πng UFW**
üëâ N·∫øu b·∫°n c·∫ßn ki·ªÉm so√°t n√¢ng cao **=> d√πng iptables**

B·∫°n mu·ªën √°p d·ª•ng v·ªõi d·ªãch v·ª• n√†o (SSH, Web, Database...)? üöÄ
